# Dockerfile.ai - Extends base production container with AI models
FROM svg-ai:latest

# Install AI-specific dependencies
RUN pip install --no-cache-dir \
    torch==2.1.0+cpu \
    scikit-learn==1.3.2 \
    stable-baselines3==2.0.0 \
    gymnasium==0.29.1 \
    deap==1.4.1 \
    transformers==4.36.0

# Create model directories
RUN mkdir -p /app/models/production /app/models/cache && \
    chown -R appuser:appuser /app/models

# Copy AI models (if available)
COPY --chown=appuser:appuser models/production/ /app/models/production/

# AI-specific environment variables
ENV MODEL_DIR=/app/models/production \
    CLASSIFIER_MODEL=classifier.pth \
    OPTIMIZER_MODEL=optimizer.xgb \
    AI_ENHANCED=true

# AI health check
HEALTHCHECK --interval=60s --timeout=15s --start-period=30s --retries=3 \
    CMD curl -f http://localhost:8000/api/ai-status || exit 1